{{> header }}
{{> head }}
<br><br><br><br><br><br><br>
<center>
    <h1>ADMINISTRADOR</h1>
</center>
<hr>
<h3 style="position: absolute; top: 255px; right:300px;">Buscar:</h3>
<form style="position: absolute; top: 260px; right:200px;">

    <select id="seleccion" name="genero">
        <option value="USER_MEDICO">MÃ©dico</option>
        <option value="USER_PACIENTE">Paciente</option>

    </select>
</form>
<br><br><br>
<table id="usuarios" class="egt" border="3" style="width:100%" "position: absolute; top: 300px; left:20px;">
    <thead>
        <tr>

            <th>id</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Cedula</th>
            <th>Correo Electronico</th>
            <th>Perfil</th>
            <th>Estado</th>
            <th>Actualizar</th>
        </tr>

    </thead>
    <tbody id="contenedor-us"></tbody>
</table>

<br><br><br><br><br><br><br><br><br>


<script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>

    $(function () {
        $.ajax({
            url: '/verusuarios',
            method: 'POST',
            contentType: 'application/json',
            success: function (response) {
                var tbodyEl = $('#contenedor-us');
                /// tbodyEl.html('');
                response.usuarios.forEach(function (usus) {
                    tbodyEl.append('<tr><th>' + usus._id + '</th><th>' + usus.nombre + '</th><th>' + usus.apellido + ' </th><th>' + usus.cedula + '</th><th>' + usus.correo + '</th><th>' + usus.perfil + '</th><th>' + usus.estado + '</th><th><button id=' + usus._id + ' value=' + usus._id + '>Actualizar</button></th></tr>');
                    $("#" + usus._id + "").on('click', (event) => {
                        event.preventDefault();
                        console.log(usus._id, "####");
                        let estado = " ";
                        if (usus.estado == true) {
                            estado = false

                        } else {
                            estado = true
                        }
                        $.ajax({
                            url: '/elegirus/' + usus._id + '',
                            method: 'PUT',
                            contentType: 'application/json',
                            data: JSON.stringify({ estado: estado }),
                            success: function (response) {
                                console.log(response);
                                location.reload();
                            }
                        });
                    });

                });

            }
        });

        $("#seleccion").on('click', (event) => {
            event.preventDefault();
            var elegir = $('#seleccion');
            var tbodyEl = $('#contenedor-us');
            tbodyEl.html(' ');
            $.ajax({
                url: '/elegirus',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ opcion: elegir.val() }),
                success: function (response) {
                    var tbodyEl2 = $('#contenedor-us');
                    response.usuarios.forEach(function (usus) {

                        tbodyEl2.append('<tr><th>' + usus._id + '</th><th>' + usus.nombre + '</th><th>' + usus.apellido + ' </th><th>' + usus.cedula + '</th><th>' + usus.correo + '</th><th>' + usus.perfil + '</th><th>' + usus.estado + '</th><th><button id=' + usus._id + ' value=' + usus._id + '>Actualizar</button></th></tr>');
                        $("#" + usus._id + "").on('click', (event) => {
                            event.preventDefault();
                            console.log(usus._id, "####");
                            let estado = " ";
                            if (usus.estado == true) {
                                estado = false

                            } else {
                                estado = true
                            }
                            $.ajax({
                                url: '/elegirus/' + usus._id + '',
                                method: 'PUT',
                                contentType: 'application/json',
                                data: JSON.stringify({ estado: estado }),
                                success: function (response) {
                                    console.log(response);
                                    location.reload();
                                }
                            });
                        });
                    })

                }
            });
        });






    });
</script>
<br><br>
{{> footer }}